<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивное уравнение Дрейка</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/numpy-js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .chart-container {
            flex: 1;
            min-width: 500px;
        }
        .controls {
            flex: 1;
            min-width: 300px;
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }
        .param-control {
            margin-bottom: 15px;
        }
        .param-control label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .param-control input {
            width: 100%;
        }
        .param-value {
            font-size: 0.9em;
            color: #666;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #e9f7ef;
            border-radius: 8px;
        }
        h1, h2 {
            color: #2c3e50;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <h1>Интерактивное уравнение Дрейка</h1>
    <p>Используйте ползунки для изменения параметров уравнения Дрейка и наблюдайте, как меняется вероятность обнаружения разумной жизни в нашей галактике.</p>
    
    <div class="container">
        <div class="chart-container">
            <canvas id="civChart"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="contactChart"></canvas>
        </div>
    </div>
    
    <div class="controls">
        <h2>Параметры уравнения Дрейка</h2>
        
        <div class="param-control">
            <label for="R_star">R* - Скорость звёздообразования (звёзд/год)</label>
            <input type="range" id="R_star_min" min="0.1" max="10" step="0.1" value="1.5">
            <input type="range" id="R_star_max" min="0.1" max="10" step="0.1" value="3.0">
            <div class="param-value">Диапазон: <span id="R_star_value">1.5 - 3.0</span></div>
        </div>
        
        <div class="param-control">
            <label for="f_p">f<sub>p</sub> - Доля звёзд с планетами</label>
            <input type="range" id="f_p_min" min="0" max="1" step="0.01" value="0.9">
            <input type="range" id="f_p_max" min="0" max="1" step="0.01" value="1.0">
            <div class="param-value">Диапазон: <span id="f_p_value">0.9 - 1.0</span></div>
        </div>
        
        <div class="param-control">
            <label for="n_e">n<sub>e</sub> - Планеты в зоне жизни</label>
            <input type="range" id="n_e_min" min="0" max="1" step="0.01" value="0.2">
            <input type="range" id="n_e_max" min="0" max="1" step="0.01" value="0.5">
            <div class="param-value">Диапазон: <span id="n_e_value">0.2 - 0.5</span></div>
        </div>
        
        <div class="param-control">
            <label for="f_l">f<sub>l</sub> - Вероятность жизни</label>
            <input type="range" id="f_l_min" min="0" max="1" step="0.01" value="0.1">
            <input type="range" id="f_l_max" min="0" max="1" step="0.01" value="0.5">
            <div class="param-value">Диапазон: <span id="f_l_value">0.1 - 0.5</span></div>
        </div>
        
        <div class="param-control">
            <label for="f_i">f<sub>i</sub> - Вероятность разума</label>
            <input type="range" id="f_i_min" min="0" max="1" step="0.01" value="0.01">
            <input type="range" id="f_i_max" min="0" max="1" step="0.01" value="0.2">
            <div class="param-value">Диапазон: <span id="f_i_value">0.01 - 0.2</span></div>
        </div>
        
        <div class="param-control">
            <label for="f_c">f<sub>c</sub> - Вероятность технологий</label>
            <input type="range" id="f_c_min" min="0" max="1" step="0.01" value="0.1">
            <input type="range" id="f_c_max" min="0" max="1" step="0.01" value="0.5">
            <div class="param-value">Диапазон: <span id="f_c_value">0.1 - 0.5</span></div>
        </div>
        
        <div class="param-control">
            <label for="L">L - Время жизни цивилизации (лет)</label>
            <input type="range" id="L_min" min="10" max="10000" step="10" value="100">
            <input type="range" id="L_max" min="10" max="10000" step="10" value="1000">
            <div class="param-value">Диапазон: <span id="L_value">100 - 1000</span></div>
        </div>
        
        <div class="param-control">
            <label for="f_detect">f<sub>detect</sub> - Доля обнаруживаемых цивилизаций</label>
            <input type="range" id="f_detect_min" min="0" max="1" step="0.01" value="0.01">
            <input type="range" id="f_detect_max" min="0" max="1" step="0.01" value="0.1">
            <div class="param-value">Диапазон: <span id="f_detect_value">0.01 - 0.1</span></div>
        </div>
        
        <div class="param-control">
            <label for="T_galaxy">T<sub>galaxy</sub> - Время наблюдения (лет)</label>
            <input type="range" id="T_galaxy" min="1000" max="1e6" step="1000" value="1e5">
            <div class="param-value">Значение: <span id="T_galaxy_value">100,000</span></div>
        </div>
        
        <button id="updateBtn">Обновить расчеты</button>
        
        <div class="results">
            <h3>Результаты:</h3>
            <p><strong>Число цивилизаций (N):</strong> <span id="median_N">-</span> (медиана)</p>
            <p><strong>Вероятность контакта:</strong> <span id="median_p">-</span> (медиана)</p>
            <p><strong>Общая вероятность контакта:</strong> <span id="p_total">-</span></p>
        </div>
    </div>

    <script>
        // Инициализация графиков
        const civCtx = document.getElementById('civChart').getContext('2d');
        const contactCtx = document.getElementById('contactChart').getContext('2d');
        
        let civChart = new Chart(civCtx, {
            type: 'histogram',
            data: { datasets: [{
                label: 'Число разумных цивилизаций (N)',
                data: [],
                backgroundColor: 'rgba(135, 206, 235, 0.7)',
                borderColor: 'rgba(0, 0, 0, 1)',
                borderWidth: 1
            }] },
            options: {
                scales: { y: { beginAtZero: true } },
                plugins: {
                    title: { display: true, text: 'Распределение оценок уравнения Дрейка' },
                    legend: { display: false }
                }
            }
        });
        
        let contactChart = new Chart(contactCtx, {
            type: 'histogram',
            data: { datasets: [{
                label: 'Вероятность контакта с одной цивилизацией',
                data: [],
                backgroundColor: 'rgba(250, 128, 114, 0.7)',
                borderColor: 'rgba(0, 0, 0, 1)',
                borderWidth: 1
            }] },
            options: {
                scales: { y: { beginAtZero: true } },
                plugins: {
                    title: { display: true, text: 'Вероятность обнаружения сигнатуры' },
                    legend: { display: false }
                }
            }
        });
        
        // Обновление значений параметров при движении ползунков
        document.querySelectorAll('input[type="range"]').forEach(slider => {
            slider.addEventListener('input', updateSliderValue);
        });
        
        function updateSliderValue(e) {
            const id = e.target.id;
            if (id.includes('_min') || id.includes('_max')) {
                const param = id.split('_')[0];
                const minVal = parseFloat(document.getElementById(`${param}_min`).value);
                const maxVal = parseFloat(document.getElementById(`${param}_max`).value);
                
                // Убедимся, что min <= max
                if (id.includes('_min') && minVal > maxVal) {
                    document.getElementById(`${param}_max`).value = minVal;
                } else if (id.includes('_max') && maxVal < minVal) {
                    document.getElementById(`${param}_min`).value = maxVal;
                }
                
                document.getElementById(`${param}_value`).textContent = 
                    `${parseFloat(document.getElementById(`${param}_min`).value).toFixed(2)} - ${parseFloat(document.getElementById(`${param}_max`).value).toFixed(2)}`;
            } else {
                const value = parseFloat(e.target.value);
                document.getElementById(`${id}_value`).textContent = value.toLocaleString();
            }
        }
        
        // Функция симуляции
        function simulateContact(params, samples=10000) {
            const N_civ = [];
            const p_contact = [];
            const galaxy_radius = 50000;  // Радиус Галактики в световых годах
            
            for (let i = 0; i < samples; i++) {
                const R = randomUniform(params.R_star[0], params.R_star[1]);
                const fp = randomUniform(params.f_p[0], params.f_p[1]);
                const ne = randomUniform(params.n_e[0], params.n_e[1]);
                const fl = randomUniform(params.f_l[0], params.f_l[1]);
                const fi = randomUniform(params.f_i[0], params.f_i[1]);
                const fc = randomUniform(params.f_c[0], params.f_c[1]);
                const L = randomUniform(params.L[0], params.L[1]);
                const f_detect = randomUniform(params.f_detect[0], params.f_detect[1]);
                
                const N = R * fp * ne * fl * fi * fc * L;
                N_civ.push(N);
                
                const active_now = (Math.random() < L / params.T_galaxy);
                const distance = randomUniform(0, galaxy_radius);
                const distance_factor = Math.exp(-distance / galaxy_radius);
                const p = active_now ? f_detect * distance_factor : 0;
                p_contact.push(p);
            }
            
            return { N_civ, p_contact };
        }
        
        function randomUniform(min, max) {
            return min + Math.random() * (max - min);
        }
        
        // Функция обновления графиков
        function updateCharts() {
            const params = {
                R_star: [
                    parseFloat(document.getElementById('R_star_min').value),
                    parseFloat(document.getElementById('R_star_max').value)
                ],
                f_p: [
                    parseFloat(document.getElementById('f_p_min').value),
                    parseFloat(document.getElementById('f_p_max').value)
                ],
                n_e: [
                    parseFloat(document.getElementById('n_e_min').value),
                    parseFloat(document.getElementById('n_e_max').value)
                ],
                f_l: [
                    parseFloat(document.getElementById('f_l_min').value),
                    parseFloat(document.getElementById('f_l_max').value)
                ],
                f_i: [
                    parseFloat(document.getElementById('f_i_min').value),
                    parseFloat(document.getElementById('f_i_max').value)
                ],
                f_c: [
                    parseFloat(document.getElementById('f_c_min').value),
                    parseFloat(document.getElementById('f_c_max').value)
                ],
                L: [
                    parseFloat(document.getElementById('L_min').value),
                    parseFloat(document.getElementById('L_max').value)
                ],
                f_detect: [
                    parseFloat(document.getElementById('f_detect_min').value),
                    parseFloat(document.getElementById('f_detect_max').value)
                ],
                T_galaxy: parseFloat(document.getElementById('T_galaxy').value)
            };
            
            const { N_civ, p_contact } = simulateContact(params);
            
            // Обновление данных графиков
            civChart.data.datasets[0].data = N_civ;
            contactChart.data.datasets[0].data = p_contact;
            
            // Расчет статистики
            const median_N = calculateMedian(N_civ);
            const median_p = calculateMedian(p_contact);
            const p_total = calculateTotalProbability(p_contact);
            
            // Обновление результатов
            document.getElementById('median_N').textContent = median_N.toFixed(1);
            document.getElementById('median_p').textContent = median_p.toFixed(6);
            document.getElementById('p_total').textContent = `${(p_total * 100).toFixed(2)}%`;
            
            // Обновление графиков
            civChart.update();
            contactChart.update();
        }
        
        function calculateMedian(arr) {
            const sorted = [...arr].sort((a, b) => a - b);
            const middle = Math.floor(sorted.length / 2);
            
            if (sorted.length % 2 === 0) {
                return (sorted[middle - 1] + sorted[middle]) / 2;
            } else {
                return sorted[middle];
            }
        }
        
        function calculateTotalProbability(p_contact) {
            let product = 1;
            for (const p of p_contact) {
                product *= (1 - p);
            }
            return 1 - product;
        }
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', () => {
            // Обновляем все значения ползунков
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                const event = { target: slider };
                updateSliderValue(event);
            });
            
            // Первый расчет
            updateCharts();
            
            // Обработчик кнопки
            document.getElementById('updateBtn').addEventListener('click', updateCharts);
        });
    </script>
</body>
</html>
